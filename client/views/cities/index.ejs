<%- include("../partials/header") %>
    <% if(currentUser) { %>
        <a href="/new">Add a new city</a></br>
    <% } %>

    <style>
        body { margin: 0; padding: 0; }
        #map { position: relative; top: 0; bottom: 0; width: 100%; height: 300px; }
    </style>

    <!-- Mapbox js code for displaying the map with the location -->
    <div id='map' class="col-xl-12" ></div></br><!-- style='width: 400px; height: 400px'  -->


    <% cities.forEach(cities => {  %>
        <p>
            <%= cities.geolocation.coordinates[0] %>
            <%= cities.geolocation.coordinates[1] %>
        </p>
    <% }) %>
  
    Display cities
    <% cities.forEach((cities) => { %>
        <div class="cities-background">
            <h2><%= cities.city %></h2>
            <h2><%= cities.country %></h2>
            <h5>Posted by <%= cities.author.username %></h5>
            <img src="<%= cities.images %>">
            <p><%= cities.description %></p>
            <div>
                <a href="/cities/<%= cities._id %>" class="btn btn-primary">More Details</a>
            </div>
        </div>
    <% }) %>
<%- include("../partials/footer") %>

<script>
    let display = 'satellite-v9';
    mapboxgl.accessToken = '<%- process.env.MAPBOX %>';
    const cities = <%- JSON.stringify(cities) %>; 

    var map = new mapboxgl.Map({
        container: 'map',
        style: `mapbox://styles/mapbox/${display}`,
        center: [-103.59179687498357, 40.66995747013945],
        zoom: 3
    });
    
    // Populate map with marker location of the cities derived from the database    
    cities.forEach(result => {
        new mapboxgl.Marker()
        .setLngLat(
        result.geolocation.coordinates)      
        .addTo(map)
    });

    

    </script>